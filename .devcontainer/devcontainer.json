{
  "name": "rust-viterbo",
  "build": {
    "dockerfile": "Dockerfile"
  },
  "init": false, // I was told "true" would prevent lots of issues... but pyright outright seems broken with "true"?
  "customizations": {
    "vscode": {
      "extensions": [
        "rust-lang.rust-analyzer",
        "vadimcn.vscode-lldb",
        "yzhang.markdown-all-in-one",
        "editorconfig.editorconfig",
        "tamasfe.even-better-toml",
        "redhat.vscode-yaml",
        "usernamehw.errorlens",
        "GitHub.copilot",
        "GitHub.copilot-chat",
        "openai.chatgpt"
      ],
      "settings": {
        "files.exclude": {
          "**/.git": true,
          "**/.svn": true,
          "**/.hg": true,
          "**/.DS_Store": true,
          "**/Thumbs.db": true,
          // Exclude worktrees since they interfere with git (keep other .persist visible)
          ".persist/vibe-worktrees/*": true,
          // python
          "**/__pycache__": true,
          "**/*.pyc": true,
          "**/.mypy_cache": true,
          "**/.pytest_cache": true,
          "**/.venv": true,
          "**/.hypothesis": true,
          // rust
          "**/target": true // build artifacts
        },
        // Keep .persist visible in Explorer, but prevent crawls/indexing.
        "files.watcherExclude": {
          "**/.persist/**": true,
          "**/data/**": true,
          "**/target/**": true,
          "**/.venv/**": true
        },
        "search.exclude": {
          "**/.persist/**": true,
          "**/data/**": true,
          "**/target/**": true,
          "**/.venv/**": true
        },
        // Prevent VS Code Git from scanning nested worktrees/caches under .persist
        "git.repositoryScanIgnoredFolders": ["**/.persist/vibe-worktrees/**"],
        // Avoid Rust Analyzer scanning caches and generated content
        "rust-analyzer.files.excludeDirs": [
          "**/.persist",
          "**/data",
          "**/docs/book",
          "**/.venv",
          "**/target"
        ],
        // If Pylance is present, mirror Pyright's ignore to avoid UI analysis on caches
        "python.analysis.exclude": [
          "**/.persist/**",
          "**/data/**",
          "**/target/**",
          "**/.venv/**"
        ]
      }
    }
  },
  // agentx configuration for ticket bundles and hooks
  "containerEnv": {
    // Ticket bundle locations (agentx and provision hook read these)
    "AGENTX_TICKETS_DIR": "/workspaces/rust-viterbo/.persist/agentx/tickets",
    "AGENTX_WORKTREES_DIR": "/workspaces/rust-viterbo/.persist/agentx/worktrees",
    "LOCAL_TICKET_FOLDER": "./shared/tickets",
    // Rust shared build cache (repo-local; excluded via .persist/)
    "CARGO_TARGET_DIR": "/workspaces/rust-viterbo/.persist/cargo-target",
    // Provision-time setup (symlink + LFS hydrate)
    "AGENTX_HOOK_PROVISION": "bash scripts/agentx-hook-provision.sh"
    // Optional quick loops on turn start:
    // "AGENTX_HOOK_START": "safe --timeout 10 -- bash scripts/python-lint-type-test.sh && safe --timeout 10 -- bash scripts/rust-fmt.sh"
  },
  "postCreateCommand": "bash .devcontainer/postCreate.sh",
  "remoteUser": "vscode"
}
